#cloud-config

write_files:
  - path: /etc/nixos/k3s_role
    content: worker
    permissions: '0644'
  - path: /etc/nixos/machine-id
    content: |
      # This file is generated by cloud-init
      # This is a worker node
      worker-node
    permissions: '0644'

runcmd:
  - [ systemctl, restart, sshd ]
  - [ systemctl, restart, tailscaled ]
  - [ systemctl, restart, k3s-agent ]
  - [ nixos-rebuild, switch ]